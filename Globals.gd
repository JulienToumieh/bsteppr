extends Node2D

var beatA = [
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"]
]

var beatB = [
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"]
]

var beatC = [
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"]
]

var beatD = [
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"]
]

var beatE = [
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"]
]

var beatF = [
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"],
	["0000","0000","0000","0000","0000","0000","0000","0000"]
]

'''
var activeBeat = beatA

var playbackPosition = 0
var playing = false

var last_tick_time = 0
var tempo = 60000/128

func togglePlayback():
	if playing:
		playing = false
		playbackPosition = 0
	else:
		playing = true

func tick():
	if playbackPosition == 16:
		playbackPosition = 1
	else:
		playbackPosition += 1
		
	if playbackPosition % 4 == 0: playSound(3)

func _ready():
	pass

func _process(delta):
	
	if playing:
		var current_time = Time.get_ticks_msec()
		if current_time - last_tick_time >= tempo/4:
			last_tick_time = current_time
			tick()


func playSound(id):
	match id:
		1: get_node("Instrument1").play()
		2: get_node("Instrument2").play()
		3: get_node("Instrument3").play()
		4: get_node("Instrument4").play()
		5: get_node("Instrument5").play()
		6: get_node("Instrument6").play()
		7: get_node("Instrument7").play()
		8: get_node("Instrument8").play()
'''



'
var beats = {
	"A": [["0000"] * 8 for _ in range(16)],
	"B": [["0000"] * 8 for _ in range(16)],
	"C": [["0000"] * 8 for _ in range(16)],
	"D": [["0000"] * 8 for _ in range(16)],
	"E": [["0000"] * 8 for _ in range(16)],
	"F": [["0000"] * 8 for _ in range(16)]
}
'

var activeBeat = beatA
var playbackPosition = 0
var playing = false

var tempo = 60000 / 128  # Tempo in milliseconds


@onready var metronome_timer = $Timer  # Reference to the Timer node

func togglePlayback():
	playing = !playing
	if playing:
		metronome_timer.start()  # Start the timer
	else:
		playbackPosition = 0
		metronome_timer.stop()  # Stop the timer

func tick():
	playbackPosition = (playbackPosition % 16) + 1
	if playbackPosition % 4 == 0:
		playSound(3)

func _ready():
	metronome_timer.wait_time = tempo / 4000.0  # Set wait time in seconds
	metronome_timer.timeout.connect(self._on_Timer_timeout)

func _on_Timer_timeout():
	tick()  # Call tick on timer timeout

func playSound(id):
	match id:
		1: get_node("Instrument1").play()
		2: get_node("Instrument2").play()
		3: get_node("Instrument3").play()
		4: get_node("Instrument4").play()
		5: get_node("Instrument5").play()
		6: get_node("Instrument6").play()
		7: get_node("Instrument7").play()
		8: get_node("Instrument8").play()
